<div class='chart'>
  <svg ref:svg viewBox="0 0 600 300">
    <g transform="translate(0,300)">
      <g transform="scale(1,-1)">
    <path class='actual-tool-path-line' d='{actualToolPath}'></path>
    <path class='target-tool-path-line' d='{targetToolPath}'></path>
    <path class='actual-bed-path-line' d='{actualBedPath}'></path>
    <path class='target-bed-path-line' d='{targetBedPath}'></path>
    <!-- <path class='path-area' d='{actualToolArea}'></path> -->
    </g></g>
  </svg>
</div>

<style>
  .chart {
    width: 60vh;
		height: 30vh;
    border: 2px solid green;
    background: rgba(20,20,20,0.3);
  }
  svg {
		position: relative;
	  width: 100%;
    height: 100%;
	}
	.actual-tool-path-line {
		fill: none;
		stroke: rgb(100,0,0);
		stroke-linejoin: round;
		stroke-linecap: round;
		stroke-width: 2;
	}

	.target-tool-path-line {
		fill: none;
		stroke: rgb(100,40,0);
		stroke-linejoin: round;
		stroke-linecap: round;
		stroke-width: 2;
	}
	.actual-bed-path-line {
		fill: none;
		stroke: rgb(18, 0, 100);
		stroke-linejoin: round;
		stroke-linecap: round;
		stroke-width: 2;
	}

	.target-bed-path-line {
		fill: none;
		stroke: rgb(64, 2, 100);
		stroke-linejoin: round;
		stroke-linecap: round;
		stroke-width: 2;
	}
	.path-area {
		fill: rgba(100,0,0,0.4);
	}
</style>

<script>
  import store from './TemperatureStore.js';
	import { scaleLinear } from 'd3-scale';

	const xScale = scaleLinear();
	const yScale = scaleLinear();

  export default {
    computed: {
      minX: ({ $history }) => {
				return $history[0] ? $history[0].time : 0;
			},
			maxX: ({ $history }) => {
				return $history[$history.length - 1] ? $history[$history.length - 1].time : 0;
      },
      xScale: ({ minX, maxX }) => {
				return xScale
					.domain([minX, maxX])
					.range([0,600]);
			},
      actualToolPath: ({ $history, xScale }) => {        
				return 'M' + $history
					.map( (point, i) => `${xScale(point.time)},${point.tool0.actual}`)
          .join('L');
      },
      targetToolPath: ({ $history, xScale }) => {        
				return 'M' + $history
					.map( (point, i) => `${xScale(point.time)},${point.tool0.target}`)
          .join('L');
      },
      actualBedPath: ({ $history, xScale }) => {        
				return 'M' + $history
					.map( (point, i) => `${xScale(point.time)},${point.bed.actual}`)
          .join('L');
      },
      targetBedPath: ({ $history, xScale }) => {        
				return 'M' + $history
					.map( (point, i) => `${xScale(point.time)},${point.bed.target}`)
          .join('L');
      },
      actualToolArea: ({ $history, xScale, yScale, minX, maxX, actualToolPath }) => {
				return actualToolPath + (
					'L' + xScale(maxX) + ',' + 0 +
					'L' + xScale(minX) + ',' + 0 +
					'Z'
				);
			}

    },
    oncreate() {
      store.start(5000);
    },
    ondestroy() {
      store.stop();
    },
    store: () => store 
  };
</script>