<div class='chart'>
  <svg ref:svg preserveAspectRatio="none" viewBox="0 0 800 300">
    <g transform="translate(0,300)">
      <g transform="scale(1,-1)">
				{#if $history.length > 0}
					<TemperatureChartPath color='#FF0000' history={toolHistory}/>
				  <TemperatureChartPath color='#0000FF' history={bedHistory}/>
			  {/if}
		  </g>
  	</g>
  </svg>
</div>

<style>
  .chart {
    bottom: 0;
    z-index: 0;
    position: absolute;
    width: 100vw;
		height: 100vh;
  }
  svg {
		position: relative;
	  width: 100%;
    height: 100%;
	}
</style>

<script>
	import store from './stores/TemperatureStore.js';
	
  export default {
		components: {
			TemperatureChartPath: './TemperatureChartPath.html'
		},
		computed: {
      bedHistory: ({ $history }) => {
        return $history
          .map(data => ({ ...data['bed'], time: data.time }))
          .filter(data => data.hasOwnProperty('actual') && data.hasOwnProperty('target'));
			},
			toolHistory: ({ $history }) => {
        return $history
          .map( data => ({ ...data['tool0'], time: data.time }) )
          .filter(data => data.hasOwnProperty('actual') && data.hasOwnProperty('target'));
			},
		},
    oncreate() {
      store.start();
    },
    ondestroy() {
      store.stop();
    },
    store: () => store 
  };
</script>