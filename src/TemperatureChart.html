<div class='chart'>
  <svg ref:svg preserveAspectRatio="none" viewBox="0 0 800 300">
    <g transform="translate(0,300)">
      <g transform="scale(1,-1)">
        {#each temperatureControls(confStore) as control}
          <TemperatureChartPath color='{control.color}' history={getHistory($temperature.history, control.key)}/>
        {/each}	
		  </g>
  	</g>
  </svg>
</div>

<style>
  .chart {
    bottom: 0;
    z-index: -10;
    position: absolute;
    width: 100vw;
		height: 100vh;
  }
  svg {
		position: relative;
	  width: 100%;
    height: 100%;
	}
</style>

<script>
	import printerStateStore from './stores/PrinterStateStore.js';
  import confStore from './stores/ConfStore.js';
  
  export default {
		components: {
			TemperatureChartPath: './TemperatureChartPath.html'
    },
    data: () => ({
      confStore: confStore
    }),
    helpers: {
      temperatureControls(confStore) {
        return confStore.get().temperatureControls;
      },
      getHistory(history, key) {
        return history
          .map(data => ({ ...data[key], time: data.time }))
          .filter(data => data.hasOwnProperty('actual') && data.hasOwnProperty('target'));
      }
    },
    store: () => printerStateStore 
  };
</script>