
<div id='temperature-slider'>
  {key} {sliderTemp}
  <div ref:track id='slider-track'>
    <div id='handle' draggable=true on:dragstart="dragstart(event)" on:drag="drag(event)" on:dragend="dragend(event)" style='top: {handlePosition}%;'></div>
  </div>
</div>

<style>
  #temperature-slider {
    float: right;
    position: relative;
    z-index: 10;
    width: 25vh;
    height: 100vh;
    box-shadow: inset 0 0 1px #54958A, inset 0 0 20px #465468;
    background: rgba(44,58,78,0.5);
  }
  
  #slider-track {
    position: absolute;
    top: 5vh;
    left: 12vh;
    width: 1vh;
    height: 85vh;
    background-color: rgb(24,38,58);
  }

  #handle {
    position: relative;
    width: 11vh;
    height: 5vh;
    left: -5vh;
    box-shadow: inset 0 0 1px #54958A, inset 0 0 20px #465468;
    background: rgba(44,58,78,0.5);
  }
</style>

<script>
    import printerStateStore from './stores/PrinterStateStore.js';
    
    export default {
      store: () => printerStateStore,
      data: () => ({
        key: false,
        sliderTemp: 0
      }),
      onstate({changed,current}) {
        if(changed.key) {
          const sliderTemp = this.store.get().temperature[current.key].target;
          this.set({sliderTemp});
        }
      },
      computed: { 
        handlePosition({sliderTemp}) {
          return 100-(sliderTemp/300*100)-2.5
        }
      },
      methods: {
        drag({y}){
          if(y==0) {return;}
          let sliderPos = 1-(y-this.refs.track.offsetTop)/this.refs.track.clientHeight
          sliderPos = sliderPos < 1 ? sliderPos : 1;
          sliderPos = sliderPos > 0 ? sliderPos : 0;   
          this.set({sliderTemp: Math.floor(sliderPos*300)});
        },
        dragstart(e) {
          e.dataTransfer.setDragImage(document.createElement('img'), 0, 0);
        },
        dragend(e) {
          const { key, sliderTemp } = this.get();
          this.store.setTemp(key, sliderTemp);
        },
      }
    }
</script>
