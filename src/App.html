
<EnclosureControl/>
<Background/>
<TemperatureChart/> 

<script>
  import store from './stores/AppDataStore.js';
  import { addJob } from './stores/StoreManager.js';
  import Job from './stores/Job.js';
 
  addJob(new Job('conf', [], () => store.updateConf() ));
  addJob(new Job('md5', [], () => store.updateMd5() ));
  addJob(new Job('apiVersion', ['conf'], () => store.updateApiVersion() ));
  addJob(new Job('connectionState', ['conf', 'apiVersion'], () => store.updateConnectionState() ));
  addJob(new Job('outputStates', ['conf', 'apiVersion'], () => store.updateOutputStates() ));
  addJob(new Job('printerState', ['conf', 'connectionState', 'apiVersion'], () => store.updatePrinterState() ));

  export default {
    store: () => store,
    data: () => ({
      md5sum: false,
    }),
    components: { 
        EnclosureControl: './EnclosureControl.html', 
        Background: './Background.html',
        TemperatureChart: './TemperatureChart.html',
    },
    oncreate() {
			const listener = this.store.on('state', ({ current }) => {
        if( !current.appMd5 ) {
          return;
        }
        if( !this.get().md5sum ) {
          this.set(current.appMd5);
        }
        if( this.get().md5sum !== current.appMd5.md5sum ){
          window.location.reload();
        } 
      });
      this.on('destroy', listener.cancel);
    }
  }

</script>